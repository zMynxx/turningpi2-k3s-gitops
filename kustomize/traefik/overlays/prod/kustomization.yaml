apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Set the deploy order in not using ArgoCD
# This will deploy the helm chart first, followed by these resources.
sortOptions:
  order: legacy
  legacySortOptions:
    orderFirst:
    - Namespace
    orderLast:
    - Middleware
    - IngressRoute
    - Secret

helmGlobals:
  chartHome: ../../../../charts/

# helmCharts: https://kubectl.docs.kubernetes.io/references/kustomize/builtins/#_helmchartinflationgenerator_
helmCharts:
# Use a Helm chart from the official Helm chart repository
- name: &name traefik 
  version: 26.1.0 
  repo: https://traefik.github.io/charts 
  releaseName: *name
  valuesFile: values.yaml
  namespace: *name
  includeCRDs: true

namespace: *name 
# Additonal resources to apply - do not worry about the order if you are using ArgoCD
resources:
- dashboard-basicauth-middlewere.yaml
- dashboard-ingressroute.yaml
- default-headers-middleware.yaml
- namespace.yaml
- eso-cloudflare-secret.yaml
- eso-dashboard-auth.yaml
